update-cabundle:
	@echo "Updating webhook manifests with CA bundle"
	CA_BUNDLE=$$(base64 -w0 < certs/ca.crt) ;\
	yq e ".webhooks[].clientConfig.caBundle = \"$$CA_BUNDLE\"" -i dev/manifests/cluster-config/mutating.config.yaml ;\
	yq e ".webhooks[].clientConfig.caBundle = \"$$CA_BUNDLE\"" -i dev/manifests/cluster-config/validating.config.yaml



clientConfig:
  service:
    name: gitlab-workspaces-kubernetes-webhook
    namespace: default
    path: "/mutate"
  caBundle: "" 
 

patch.sh
make update-cabundle